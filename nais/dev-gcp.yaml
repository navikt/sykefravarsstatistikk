apiVersion: nais.io/v1alpha1
kind: Application
metadata:
    name: sykefravarsstatistikk
    namespace: arbeidsgiver
    labels:
        team: arbeidsgiver
spec:
    image: {{ image }}
    team: arbeidsgiver
    port: 3000
    vault:
        enabled: true
    ingresses:
        - https://arbeidsgiver-gcp.dev.nav.no/sykefravarsstatistikk
    liveness:
        path: /sykefravarsstatistikk/internal/isAlive
        initialDelay: 10
    readiness:
        path: /sykefravarsstatistikk/internal/isReady
        initialDelay: 10
    env:
        - name: BACKEND_API_BASE_URL
          value: https://sykefravarsstatistikk-api.dev-fss-pub.nais.io
        - name: IA_TJENESTER_METRIKKER_BASE_URL
          value: http://ia-tjenester-metrikker/ia-tjenester-metrikker
        - name: NODE_EXTRA_CA_CERTS
          value: /etc/ssl/ca-bundle.pem
        - name: LOGIN_URL
          value: https://loginservice.dev.nav.no/login?redirect=
        - name: APP_INGRESS
          value: https://arbeidsgiver-gcp.dev.nav.no/sykefravarsstatistikk
        - name: SYKEFRAVARSSTATISTIKK_API_AUDIENCE
          value: "dev-fss:arbeidsgiver:sykefravarsstatistikk-api"
        - name: IA_TJENESTER_METRIKKER_AUDIENCE
          value: "dev-gcp:arbeidsgiver:ia-tjenester-metrikker"
        - name: NOTIFIKASJON_API_AUDIENCE
          value: "dev-gcp:fager:notifikasjon-bruker-api"
    tokenx:
        enabled: true
    idporten:
        enabled: true
        sidecar:
            enabled: true
    accessPolicy:
        outbound:
            rules:
                - application: sykefravarsstatistikk-api
                  namespace: arbeidsgiver
                  cluster: dev-fss
                - application: notifikasjon-bruker-api
                  namespace: fager
                - application: ia-tjenester-metrikker
                  namespace: arbeidsgiver
                  cluster: dev-gcp
            external:
                - host: dekoratoren.dev.nav.no
                - host: sykefravarsstatistikk-api.dev-fss-pub.nais.io
                - host: loginservice.dev.nav.no
